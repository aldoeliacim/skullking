<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app.title">Skull King</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè¥‚Äç‚ò†Ô∏è</text></svg>">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Language Switcher -->
        <button id="lang-toggle" class="lang-btn" title="Switch language">
            <span id="lang-flag">EN</span>
        </button>

        <!-- Rulebook Button -->
        <button id="rules-toggle" class="rules-btn" title="View Rules">
            <span>&#128214;</span>
        </button>

        <!-- Login Screen -->
        <div id="login-screen" class="screen active">
            <div class="login-container">
                <div class="logo">
                    <div class="skull-icon">&#9760;</div>
                    <h1>Skull King</h1>
                    <p class="tagline" data-i18n="app.subtitle">A trick-taking pirate card game</p>
                </div>
                <div class="login-form">
                    <div class="input-group">
                        <label for="username-input" data-i18n="login.yourName">Your Name</label>
                        <input type="text" id="username-input" data-i18n-placeholder="login.enterName" placeholder="Captain..." maxlength="20" autocomplete="off">
                    </div>
                    <button id="create-game-btn" class="btn btn-primary btn-large">
                        <span class="btn-icon">+</span>
                        <span data-i18n="login.createGame">Create Game</span>
                    </button>
                    <div class="divider"><span data-i18n="login.or">or join existing</span></div>
                    <div class="input-group">
                        <label for="game-id-input" data-i18n="login.gameCode">Game Code</label>
                        <input type="text" id="game-id-input" data-i18n-placeholder="login.enterGameId" placeholder="Enter code..." autocomplete="off">
                    </div>
                    <button id="join-game-btn" class="btn btn-secondary">
                        <span data-i18n="login.joinGame">Join Game</span>
                    </button>
                </div>
                <div id="login-error" class="error-message"></div>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <div class="lobby-container">
                <div class="lobby-header">
                    <h2 data-i18n="lobby.title">Game Lobby</h2>
                    <div class="game-code-box">
                        <span class="label" data-i18n="lobby.shareCode">Share this code:</span>
                        <div class="code-display">
                            <span id="lobby-game-id" class="code"></span>
                            <button id="copy-game-id-btn" class="btn-icon-only" title="Copy">
                                <span class="copy-icon">&#128203;</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="lobby-content">
                    <!-- Players Panel -->
                    <div class="lobby-panel players-panel">
                        <div class="panel-header">
                            <h3><span data-i18n="lobby.players">Players</span> <span class="player-count">(<span id="player-count">0</span>/4)</span></h3>
                        </div>
                        <ul id="lobby-players" class="players-list"></ul>
                    </div>

                    <!-- Config Panel (Host Only) -->
                    <div id="config-panel" class="lobby-panel config-panel">
                        <div class="panel-header">
                            <h3 data-i18n="lobby.gameSettings">Game Settings</h3>
                        </div>

                        <div class="config-section">
                            <h4 data-i18n="lobby.addOpponents">Add Opponents</h4>
                            <div class="bot-config">
                                <div class="config-row">
                                    <label data-i18n="lobby.botType">Bot Type</label>
                                    <select id="bot-type-select" class="select-input">
                                        <option value="rl" data-i18n="lobby.botRL">AI (Neural Network)</option>
                                        <option value="rule_based" data-i18n="lobby.botRuleBased">Rule-Based</option>
                                        <option value="random" data-i18n="lobby.botRandom">Random</option>
                                    </select>
                                </div>
                                <div class="config-row">
                                    <label data-i18n="lobby.difficulty">Difficulty</label>
                                    <select id="bot-difficulty-select" class="select-input">
                                        <option value="easy" data-i18n="lobby.easy">Easy</option>
                                        <option value="medium" selected data-i18n="lobby.medium">Medium</option>
                                        <option value="hard" data-i18n="lobby.hard">Hard</option>
                                    </select>
                                </div>
                                <button id="add-bot-btn" class="btn btn-secondary">
                                    <span class="btn-icon">+</span>
                                    <span data-i18n="lobby.addBot">Add Bot</span>
                                </button>
                            </div>
                        </div>

                        <div class="config-section">
                            <h4 data-i18n="lobby.quickSetup">Quick Setup</h4>
                            <div class="quick-buttons">
                                <button id="fill-bots-btn" class="btn btn-outline btn-small" data-i18n="lobby.fillWithBots">Fill with AI Bots</button>
                                <button id="clear-bots-btn" class="btn btn-outline btn-small" data-i18n="lobby.clearBots">Remove All Bots</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lobby-actions">
                    <button id="leave-lobby-btn" class="btn btn-ghost" data-i18n="lobby.leave">Leave</button>
                    <button id="start-game-btn" class="btn btn-primary btn-large" disabled>
                        <span data-i18n="lobby.startGame">Start Game</span>
                        <span class="btn-icon">&#9654;</span>
                    </button>
                </div>
                <p id="start-hint" class="hint" data-i18n="lobby.needPlayers">Need at least 2 players to start</p>
                <div id="lobby-error" class="error-message"></div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-layout">
                <!-- Top Bar - Fixed -->
                <header class="game-topbar">
                    <div class="topbar-left">
                        <div class="round-badge">
                            <span data-i18n="game.round">Round</span>
                            <strong><span id="current-round">1</span>/10</strong>
                        </div>
                        <div class="game-phase" id="game-status-text" data-i18n="game.waiting">Waiting...</div>
                    </div>
                    <div class="topbar-right">
                        <button id="rules-toggle-game" class="topbar-btn" title="Rules">
                            <span>&#128214;</span>
                        </button>
                        <button id="lang-toggle-game" class="topbar-btn" title="Language">
                            <span id="lang-flag-game">EN</span>
                        </button>
                    </div>
                </header>

                <!-- Floating Scoreboard Dropdown -->
                <div id="scoreboard-bar" class="scoreboard-bar">
                    <button id="scoreboard-toggle-bar" class="scoreboard-toggle-bar">
                        <span class="toggle-icon">‚ñº</span>
                        <span data-i18n="game.scoreboard">Scoreboard</span>
                    </button>
                    <div id="scoreboard-dropdown" class="scoreboard-dropdown hidden">
                        <table class="scoreboard-table-compact">
                            <thead>
                                <tr>
                                    <th data-i18n="results.player">Player</th>
                                    <th data-i18n="game.bid">Bid</th>
                                    <th data-i18n="game.tricks">Won</th>
                                    <th data-i18n="results.score">Score</th>
                                </tr>
                            </thead>
                            <tbody id="scoreboard-dropdown-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Main Game Area - Table Layout -->
                <main class="game-main game-table-layout">
                    <!-- Turn Arrow Indicator -->
                    <div id="turn-arrow" class="turn-arrow hidden">
                        <div class="arrow-indicator"></div>
                    </div>

                    <!-- Top opponents -->
                    <div class="table-side table-top" id="opponents-top"></div>

                    <!-- Middle row: Left opponents, Table, Right opponents -->
                    <div class="table-middle-row">
                        <div class="table-side table-left" id="opponents-left"></div>

                        <!-- Center Play Area -->
                        <div class="play-area">
                            <div class="table-felt">
                                <h3 class="area-label" data-i18n="game.currentTrick">Current Trick</h3>
                                <div id="trick-cards" class="trick-cards"></div>
                                <div id="trick-winner" class="trick-winner hidden"></div>
                            </div>
                        </div>

                        <div class="table-side table-right" id="opponents-right"></div>
                    </div>

                    <!-- Legacy container for JS compatibility -->
                    <div id="opponents-container" class="hidden"></div>

                    <!-- Player Hand Area (Bottom) -->
                    <div class="player-area">
                        <div class="player-info-bar">
                            <div class="player-stat-item score-item">
                                <span class="stat-label" data-i18n="game.yourScore">Score:</span>
                                <span class="stat-value score-value" id="player-score">0</span>
                            </div>
                            <div class="player-stat-item">
                                <span class="stat-label" data-i18n="game.yourBid">Bid:</span>
                                <span class="stat-value" id="player-bid">-</span>
                            </div>
                            <div class="player-stat-item">
                                <span class="stat-label" data-i18n="game.tricksWon">Won:</span>
                                <span class="stat-value" id="player-tricks">0</span>
                            </div>
                            <div class="player-stat-item your-turn-indicator hidden" id="your-turn-indicator">
                                <span data-i18n="game.yourTurn">Your Turn!</span>
                            </div>
                        </div>
                        <div class="hand-section">
                            <div class="hand-label">
                                <span data-i18n="game.yourHand">Your Hand</span>
                                <span class="card-count">(<span id="hand-count">0</span>)</span>
                            </div>
                            <div id="player-hand" class="hand-cards"></div>
                        </div>
                    </div>
                </main>

                <!-- Bidding Modal -->
                <div id="bidding-modal" class="modal hidden">
                    <div class="modal-content bidding-content">
                        <h3 data-i18n="game.makeYourBid">Make Your Bid</h3>
                        <p data-i18n="game.bidQuestion">How many tricks will you win?</p>
                        <div id="bid-buttons" class="bid-buttons"></div>
                        <div class="bid-hand-preview">
                            <div class="bid-hand-label" data-i18n="game.yourHand">Your Hand</div>
                            <div id="bid-hand-cards" class="bid-hand-cards"></div>
                        </div>
                    </div>
                </div>

                <!-- Tigress Choice Modal -->
                <div id="tigress-modal" class="modal hidden">
                    <div class="modal-content tigress-content">
                        <h3 data-i18n="game.tigressChoice">Scary Mary</h3>
                        <p data-i18n="game.tigressQuestion">Play as Pirate or Escape?</p>
                        <div class="tigress-card-preview">üè¥‚Äç‚ò†Ô∏èüëª</div>
                        <div class="tigress-buttons">
                            <button id="tigress-pirate" class="tigress-btn pirate-btn">
                                <span class="tigress-icon">üè¥‚Äç‚ò†Ô∏è</span>
                                <span data-i18n="game.tigressPirate">Pirate</span>
                                <small data-i18n="game.tigressPirateDesc">Win tricks, beats suits</small>
                            </button>
                            <button id="tigress-escape" class="tigress-btn escape-btn">
                                <span class="tigress-icon">üëª</span>
                                <span data-i18n="game.tigressEscape">Escape</span>
                                <small data-i18n="game.tigressEscapeDesc">Lose on purpose</small>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Rulebook Modal -->
                <div id="rules-modal" class="modal hidden">
                    <div class="modal-content rules-content">
                        <div class="rules-header">
                            <h3>&#128214; Skull King Rules</h3>
                            <button id="rules-close" class="btn-icon-only" title="Close">&#10005;</button>
                        </div>
                        <div class="rules-body">
                            <section class="rules-section">
                                <h4>&#127183; Goal</h4>
                                <p>Predict exactly how many tricks you'll win each round. Score points for correct predictions!</p>
                            </section>

                            <section class="rules-section">
                                <h4>&#9878; Card Hierarchy (High to Low)</h4>
                                <div class="card-hierarchy">
                                    <div class="hierarchy-item special">
                                        <span class="h-icon">&#128128;</span>
                                        <span class="h-name">Skull King</span>
                                        <span class="h-desc">Beats all except Mermaid</span>
                                    </div>
                                    <div class="hierarchy-item special">
                                        <span class="h-icon">&#128126;</span>
                                        <span class="h-name">Pirates (5)</span>
                                        <span class="h-desc">Beat all suits, lose to King</span>
                                    </div>
                                    <div class="hierarchy-item special">
                                        <span class="h-icon">&#129500;</span>
                                        <span class="h-name">Mermaids (2)</span>
                                        <span class="h-desc">Beat suits, lose to Pirates, capture King!</span>
                                    </div>
                                    <div class="hierarchy-item trump">
                                        <span class="h-icon">&#127988;</span>
                                        <span class="h-name">Black (Roger)</span>
                                        <span class="h-desc">Trump suit, beats other suits</span>
                                    </div>
                                    <div class="hierarchy-item suits">
                                        <span class="h-icon">&#128230;&#127803;&#128506;</span>
                                        <span class="h-name">Other Suits</span>
                                        <span class="h-desc">Yellow (Chest), Green (Parrot), Purple (Map)</span>
                                    </div>
                                </div>
                            </section>

                            <section class="rules-section">
                                <h4>&#10024; Special Cards</h4>
                                <div class="special-cards">
                                    <div class="special-item">
                                        <span class="s-icon">&#127875;</span>
                                        <span class="s-name">Escape</span>
                                        <span class="s-desc">Always loses</span>
                                    </div>
                                    <div class="special-item">
                                        <span class="s-icon">&#129417;</span>
                                        <span class="s-name">Kraken</span>
                                        <span class="s-desc">Destroys trick, no winner</span>
                                    </div>
                                    <div class="special-item">
                                        <span class="s-icon">&#128011;</span>
                                        <span class="s-name">White Whale</span>
                                        <span class="s-desc">Highest number wins, specials destroyed</span>
                                    </div>
                                    <div class="special-item">
                                        <span class="s-icon">&#127917;</span>
                                        <span class="s-name">Tigress</span>
                                        <span class="s-desc">Choose: Pirate or Escape</span>
                                    </div>
                                    <div class="special-item">
                                        <span class="s-icon">&#128176;</span>
                                        <span class="s-name">Loot</span>
                                        <span class="s-desc">Like Escape, but has bonus</span>
                                    </div>
                                </div>
                            </section>

                            <section class="rules-section">
                                <h4>&#128181; Scoring</h4>
                                <div class="scoring-rules">
                                    <div class="score-item correct">
                                        <span class="score-label">Correct Bid (non-zero)</span>
                                        <span class="score-value">+20 x bid + bonuses</span>
                                    </div>
                                    <div class="score-item correct">
                                        <span class="score-label">Correct Zero Bid</span>
                                        <span class="score-value">+10 x round number</span>
                                    </div>
                                    <div class="score-item wrong">
                                        <span class="score-label">Wrong Bid (non-zero)</span>
                                        <span class="score-value">-10 x difference</span>
                                    </div>
                                    <div class="score-item wrong">
                                        <span class="score-label">Wrong Zero Bid</span>
                                        <span class="score-value">-10 x round number</span>
                                    </div>
                                </div>
                            </section>

                            <section class="rules-section">
                                <h4>&#127873; Bonus Points</h4>
                                <ul class="bonus-list">
                                    <li><strong>+10</strong> per standard 14 captured</li>
                                    <li><strong>+20</strong> for Black 14 (Roger)</li>
                                    <li><strong>+20</strong> Pirate captures Mermaid</li>
                                    <li><strong>+30</strong> Skull King captures Pirate</li>
                                    <li><strong>+40</strong> Mermaid captures Skull King</li>
                                </ul>
                            </section>

                            <section class="rules-section">
                                <h4>&#128712; Suit Following</h4>
                                <p>You must follow the lead suit if you can. Special cards (King, Pirates, Mermaids, Escapes) can always be played.</p>
                            </section>
                        </div>
                    </div>
                </div>

                <!-- Game Log (collapsible) -->
                <aside class="game-log collapsed" id="game-log">
                    <button class="log-toggle" id="log-toggle">
                        <span data-i18n="game.gameLog">Game Log</span>
                        <span class="toggle-icon">&#9650;</span>
                    </button>
                    <div class="log-content" id="log-messages"></div>
                </aside>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <div class="results-header">
                    <div class="trophy">&#127942;</div>
                    <h2 data-i18n="results.title">Game Over!</h2>
                    <div id="winner-announcement" class="winner-announcement"></div>
                </div>
                <div class="podium">
                    <div class="podium-place second" id="place-2"></div>
                    <div class="podium-place first" id="place-1"></div>
                    <div class="podium-place third" id="place-3"></div>
                </div>
                <table id="final-scores-table" class="scores-table">
                    <thead>
                        <tr>
                            <th data-i18n="results.rank">#</th>
                            <th data-i18n="results.player">Player</th>
                            <th data-i18n="results.score">Score</th>
                        </tr>
                    </thead>
                    <tbody id="final-scores-body"></tbody>
                </table>
                <div class="results-actions">
                    <button id="new-game-btn" class="btn btn-primary btn-large">
                        <span class="btn-icon">üè¥‚Äç‚ò†Ô∏è</span>
                        <span data-i18n="results.playAgain">Play Again</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/i18n.js"></script>
    <script src="/static/js/game.js"></script>
</body>
</html>
